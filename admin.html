<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN - THE HOON STUDIO</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase SDK ì¶”ê°€ -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
                // Firebase ì„¤ì • - ì—¬ê¸°ì— ë³¸ì¸ì˜ Firebase ì„¤ì •ê°’ì„ ì…ë ¥í•˜ì„¸ìš”
        const firebaseConfig = {
            apiKey: "AIzaSyDUJrHXzQfZ2-FwaZcuMcLu-71gRTVO2b4",
            authDomain: "the-hoon-studio.firebaseapp.com",
            projectId: "the-hoon-studio",
            storageBucket: "the-hoon-studio.firebasestorage.app",
            messagingSenderId: "857575526697",
            appId: "1:857575526697:web:43d66881a72f96e5a6e738"
        };

        
        // Firebase ì´ˆê¸°í™”
        console.log('Firebase ì´ˆê¸°í™” ì‹œì‘...');
        const app = initializeApp(firebaseConfig);
        console.log('Firebase ì•± ì´ˆê¸°í™” ì™„ë£Œ');
        
        const db = getFirestore(app);
        console.log('Firestore ì´ˆê¸°í™” ì™„ë£Œ');
        
        // ì˜¤í”„ë¼ì¸ ì§€ì†ì„± ë¹„í™œì„±í™” (ë¬¸ì œ í•´ê²°ìš©)
        try {
            db._delegate._databaseId.projectId = firebaseConfig.projectId;
            console.log('ì˜¤í”„ë¼ì¸ ì„¤ì • ì ìš© ì™„ë£Œ');
        } catch (error) {
            console.log('ì˜¤í”„ë¼ì¸ ì„¤ì • ìŠ¤í‚µ:', error);
        }
        
        // ì „ì—­ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
        window.db = db;
        window.firestoreFunctions = {
            collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, orderBy
        };
        
        console.log('Firebase ì´ˆê¸°í™” ì™„ë£Œ');
        console.log('window.db ì„¤ì •ë¨:', !!window.db);
        console.log('window.firestoreFunctions ì„¤ì •ë¨:', !!window.firestoreFunctions);
    </script>
    
    <style>
        /* í† ìŠ¤ ìŠ¤íƒ€ì¼ ê´€ë¦¬ì í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
        body.admin-page {
            background-color: #000000;
            background-image: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #ffffff;
            margin: 0;
            padding: 0;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .admin-header {
            background: #111111;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 40px;
            border: 1px solid #333333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(20px);
        }

        .admin-title {
            font-family: 'Syncopate-Bold', sans-serif;
            font-size: 28px;
            color: #ffffff;
            margin: 0;
            font-weight: 700;
        }

        .logout-btn {
            background: #ffffff;
            color: #000000;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        /* Firebase ì—°ê²° ìƒíƒœ í‘œì‹œ */
        .firebase-status {
            padding: 16px;
            margin-bottom: 30px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            border: 1px solid;
        }

        .firebase-connected {
            background: #0a0a0a;
            color: #00ff88;
            border-color: #00ff88;
        }

        .firebase-error {
            background: #0a0a0a;
            color: #ff4444;
            border-color: #ff4444;
        }

        /* ë¡œê·¸ì¸ í¼ - í† ìŠ¤ ìŠ¤íƒ€ì¼ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #000000;
        }

        .login-form {
            background: #111111;
            padding: 50px;
            border-radius: 20px;
            border: 1px solid #333333;
            width: 100%;
            max-width: 450px;
            backdrop-filter: blur(20px);
        }

        .login-form h2 {
            font-family: 'Syncopate-Bold', sans-serif;
            text-align: center;
            margin-bottom: 40px;
            color: #ffffff;
            font-size: 28px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid #333333;
            border-radius: 12px;
            font-size: 16px;
            box-sizing: border-box;
            background: #0a0a0a;
            color: #ffffff;
            transition: all 0.2s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ffffff;
            background: #111111;
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        .btn {
            background: #ffffff;
            color: #000000;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 600;
            width: auto;
            min-width: 150px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,255,255,0.2);
        }

        .btn:disabled {
            background: #333333;
            color: #666666;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #00ff88;
            color: #000000;
        }

        .btn-success:hover {
            background: #00cc6a;
        }

        .btn-danger {
            background: #ff4444;
            color: #ffffff;
            padding: 10px 20px;
            font-size: 14px;
            width: auto;
        }

        .btn-danger:hover {
            background: #ff2222;
        }

        .btn-edit {
            background: #ffffff;
            color: #000000;
            padding: 10px 20px;
            font-size: 14px;
            width: auto;
            margin-right: 10px;
        }

        .btn-edit:hover {
            background: #f0f0f0;
        }

        /* í”„ë¡œì íŠ¸ ê´€ë¦¬ ì˜ì—­ */
        .admin-section {
            background: #111111;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 40px;
            border: 1px solid #333333;
            backdrop-filter: blur(20px);
        }

        .section-title {
            font-family: 'Syncopate-Regular', sans-serif;
            font-size: 20px;
            margin-bottom: 30px;
            color: #ffffff;
            border-bottom: 2px solid #ffffff;
            padding-bottom: 15px;
            font-weight: 600;
        }

        .project-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            border-radius: 12px;
            overflow: hidden;
        }

        .project-table th,
        .project-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #333333;
        }

        .project-table th {
            background: #0a0a0a;
            font-weight: 600;
            color: #ffffff;
            font-size: 14px;
        }

        .project-table td {
            color: #ffffff;
            font-size: 14px;
        }

        .project-table tr:hover {
            background: #1a1a1a;
        }

        .alert {
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 12px;
            font-weight: 500;
        }

        .alert-success {
            background: #0a0a0a;
            color: #00ff88;
            border: 1px solid #00ff88;
        }

        .alert-error {
            background: #0a0a0a;
            color: #ff4444;
            border: 1px solid #ff4444;
        }

        .hidden {
            display: none;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ê´€ë¦¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .slide-images-container,
        .additional-images-container {
            margin-bottom: 20px;
        }

        .slide-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
            min-height: 60px;
            border: 2px dashed #333333;
            padding: 20px;
            border-radius: 12px;
            background: #0a0a0a;
        }

        .slide-preview-item {
            position: relative;
            background: #111111;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #333333;
            cursor: move;
            transition: all 0.2s ease;
        }

        .slide-preview-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,255,255,0.1);
        }

        .slide-preview-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }

        .slide-preview-controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 8px;
        }

        .slide-control-btn {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: rgba(0,0,0,0.8);
            color: #ffffff;
            transition: all 0.2s ease;
        }

        .delete-slide-btn {
            color: #ff4444;
        }

        .delete-slide-btn:hover {
            background: #ff4444;
            color: white;
            transform: scale(1.1);
        }

        .slide-preview-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .form-help {
            color: #999999;
            font-size: 12px;
            margin-top: 8px;
        }

        /* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .image-preview-single {
            margin-top: 15px;
            max-width: 200px;
        }

        .image-preview-single img {
            width: 100%;
            height: auto;
            border-radius: 12px;
            border: 1px solid #333333;
        }

        .additional-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
            min-height: 50px;
            border: 2px dashed #333333;
            padding: 15px;
            border-radius: 12px;
            background: #0a0a0a;
        }

        .additional-preview-item {
            position: relative;
            background: #111111;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #333333;
            transition: all 0.2s ease;
        }

        .additional-preview-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,255,255,0.1);
        }

        .additional-preview-img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            display: block;
        }

        /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
            margin-top: 30px;
            flex-wrap: wrap; /* í™”ë©´ì´ ì‘ì„ ë•Œ ì¤„ë°”ê¿ˆ */
        }
        
        /* ì·¨ì†Œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-secondary {
            background: #333333;
            color: #ffffff;
        }
        
        .btn-secondary:hover {
            background: #444444;
        }

        /* ë¡œê·¸ì¸ í¼ì˜ ë²„íŠ¼ì€ ì˜ˆì™¸ì ìœ¼ë¡œ ì „ì²´ ë„ˆë¹„ ìœ ì§€ */
        .login-form .btn {
            width: 100%;
        }
        
        /* í…Œì´ë¸” ë‚´ ë²„íŠ¼ë“¤ì€ ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        .btn-edit,
        .btn-danger {
            width: auto;
            min-width: auto;
            padding: 10px 20px;
            font-size: 14px;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .button-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .btn {
                width: 100%;
                min-width: auto;
            }
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid #333333;
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì¶”ê°€ í† ìŠ¤ ìŠ¤íƒ€ì¼ ìš”ì†Œë“¤ */
        .hidden {
            display: none !important;
        }

        .form-row {
            display: flex;
            gap: 25px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444444;
        }
    </style>
</head>
<body class="admin-page">
    <!-- ë¡œê·¸ì¸ í™”ë©´ - placeholder ì œê±° -->
    <div id="loginScreen" class="login-container">
        <div class="login-form">
            <h2>ADMIN LOGIN</h2>
            <div id="loginAlert" class="alert alert-error hidden"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">ì‚¬ìš©ìëª…</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn">ë¡œê·¸ì¸</button>
            </form>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ -->
    <div id="adminDashboard" class="hidden">
        <div class="admin-container">
            <!-- Firebase ì—°ê²° ìƒíƒœ -->
            <div id="firebaseStatus" class="firebase-status firebase-error">
                ğŸ”¥ Firebase ì—°ê²°ì„ í™•ì¸í•˜ëŠ” ì¤‘...
            </div>

            <!-- í—¤ë” -->
            <div class="admin-header">
                <h1 class="admin-title">THE HOON STUDIO - Adminbereich</h1>
                <button id="logoutBtn" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
            </div>

            <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
            <div id="alertMessage" class="alert hidden"></div>

            <!-- í”„ë¡œì íŠ¸ ì¶”ê°€ í¼ -->
            <div class="admin-section">
                <h2 class="section-title">ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€</h2>
                <form id="projectForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectName">PROJEKTNAME (z.B. abc.def)</label>
                            <input type="text" id="projectName" required placeholder="abc.def">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectCategory">Kategorie</label>
                            <select id="projectCategory" required>
                                <option value="architecture">ARCHITECTURE</option>
                                <option value="interior-rendering">INTERIOR DESIGN/RENDERING</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Unterkategorie (Mehrfachauswahl mÃ¶glich)</label>
                            <div id="projectCategories" style="display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 6px 18px; justify-items: start; max-width: 600px; margin: 0 auto 8px auto;">
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="D"> Design Development (D)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="P"> Building Permit (P)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="E"> Execution Planning (E)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="H"> Heritage Preservation (H)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="N"> New Construction (N)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="R"> Renovation (R)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="M/G"> Marketing/Graphic Design (M/G)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="I/R"> Interior Design/Rendering (I/R)</label>
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap; font-size: 0.675em;"><input type="checkbox" name="projectCategories" value="C"> Competition (C)</label>
                        </div>
                        </div>
                        <!--
                        <div class="form-group">
                            <label for="projectCategory">KATEGORIE</label>
                            <select id="projectCategory" required>
                                <option value="">KATEGORIE AUSWAHL</option>
                                <option value="architecture">ARCHITECTURE</option>
                                <option value="interior-rendering">INTERIOR DESIGN/RENDERING</option>
                            </select>
                        </div>
                        -->
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectYear">JAHR</label>
                            <input type="number" id="projectYear" placeholder="2024 (ì„ íƒì‚¬í•­)">
                        </div>
                        <div class="form-group">
                            <label for="projectStatus">STATUS</label>
                            <select id="projectStatus">
                                <option value="In Planning">In Planning</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                                <option value="On Hold">On Hold</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectDeveloper">PROJEKTENTWICKLER</label>
                            <input type="text" id="projectDeveloper" placeholder="ABC DEVELOPMENT GMBH">
                        </div>
                        <div class="form-group">
                            <label for="projectManager">BAUHERR, PROJEKTSTEUERER UND VERMAKTUNG</label>
                            <input type="text" id="projectManager" placeholder="ABC CAPITAL + GRUNDBESITZ MÃœNCHEN GMBH">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectPlanning">GENEHMIGUNGS- UND AUSFÃœHRUNGSPLANUNG</label>
                            <input type="text" id="projectPlanning" placeholder="ABC ARCHITEKTEN PARTGMBH">
                        </div>
                        <div class="form-group">
                            <label for="projectStructure">TRAGWERKSPLANUNG</label>
                            <input type="text" id="projectStructure" placeholder="IB ABC KIES DR. ING ABC REINECKE">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectLocation">ORT</label>
                            <input type="text" id="projectLocation" placeholder="Munich">
                        </div>
                        <div class="form-group">
                            <label for="projectInterior">INTERIOR/RENDERING</label>
                            <input type="text" id="projectInterior" placeholder="THE HOON STUDIO">
                        </div>
                    </div>

                    <!-- ë©”ì¸ ì´ë¯¸ì§€ ì„¹ì…˜ -->
                    <div class="form-group">
                        <label for="projectImage">HAUPT-BILD (PROJEKTREPRÃ„SENTATIVES BILD):</label>
                        <input type="file" id="projectImage" name="projectImage" accept="image/*" required>
                        <div id="mainImagePreview" class="image-preview-single"></div>
                        <small class="form-help">Das Bild wird auf der Projektliste und der Detailseite oben angezeigt. (1MB ì œí•œì„ ìœ„í•œ ê°•í•œ ì••ì¶•ì´ ì ìš©ë©ë‹ˆë‹¤)</small>
                    </div>

                    <!-- ìƒì„¸ ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ì„¹ì…˜ -->
                    <div class="form-group">
                        <label for="slideImages">DETAIL-SLIDE-BILDER (LINKS/RECHTS SLIDE):</label>
                        <div class="slide-images-container">
                            <input type="file" id="slideImages" name="slideImages" accept="image/*" multiple>
                        </div>
                        <div class="slide-preview-container" id="slidePreviewContainer">
                            <!-- ì„ íƒëœ ì´ë¯¸ì§€ë“¤ì˜ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                        <small class="form-help">Die Bilder, die Sie mit den Pfeiltasten durchblÃ¤ttern kÃ¶nnen, um auf der Detailseite anzuzeigen. (1MB ì œí•œì„ ìœ„í•œ ê°•í•œ ì••ì¶•ì´ ì ìš©ë©ë‹ˆë‹¤)</small>
                    </div>

                    <!-- ì¶”ê°€ ì´ë¯¸ì§€ ì„¹ì…˜ -->
                    <div class="form-group">
                        <label for="additionalImages">ZUSÃ„TZLICHE GALERIE-BILDER (FÃœR UNTERSEITEN-ABSCHNITT):</label>
                        <div class="additional-images-container">
                            <input type="file" id="additionalImages" name="additionalImages" accept="image/*" multiple>
                        </div>
                        <div class="additional-preview-container" id="additionalPreviewContainer">
                            <!-- ì¶”ê°€ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
                        </div>
                        <small class="form-help">Die Bilder, die auf der anderen Seite des anderen Abschnitts angezeigt werden. (1MB ì œí•œì„ ìœ„í•œ ê°•í•œ ì••ì¶•ì´ ì ìš©ë©ë‹ˆë‹¤)</small>
                    </div>

                    <div class="form-group">
                        <div class="button-container">
                            <button type="submit" class="btn btn-success" id="submitBtn">PROJEKT HINZUFÃœGEN</button>
                            <button type="button" id="cancelEdit" class="btn btn-secondary hidden">ABBRECHEN</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- í”„ë¡œì íŠ¸ ëª©ë¡ -->
            <div class="admin-section">
                <h2 class="section-title">REGISTRIERTE PROJEKTE</h2>
                <div id="projectsLoader" class="hidden" style="text-align: center; padding: 20px;">
                    <div class="loading"></div> PROJEKT LADEN IN GEHENDE...
                </div>
                <table class="project-table">
                    <thead>
                        <tr>
                            <th>PROJEKTNAME</th>
                            <th>KATEGORIE</th>
                            <th>ORT</th>
                            <th>JAHR</th>
                            <th>STATUS</th>
                            <th>VERWALTEN</th>
                        </tr>
                    </thead>
                    <tbody id="projectList">
                        <!-- í”„ë¡œì íŠ¸ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
            </div>

            <!-- ë©¤ë²„ ì¶”ê°€ ì„¹ì…˜ -->
            <div class="admin-section">
                <h2 class="section-title">ë©¤ë²„ ì¶”ê°€</h2>
                <form id="memberAddForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="memberName">ì´ë¦„</label>
                            <input type="text" id="memberName" required placeholder="ì´ë¦„">
                        </div>
                        <div class="form-group">
                            <label for="memberPosition">ì§ì±…</label>
                            <input type="text" id="memberPosition" required placeholder="ì§ì±…">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="memberEmail">ì´ë©”ì¼</label>
                            <input type="email" id="memberEmail" required placeholder="ì´ë©”ì¼">
                        </div>
                        <div class="form-group">
                            <label for="memberImage">í”„ë¡œí•„ ì´ë¯¸ì§€</label>
                            <input type="file" id="memberImage" accept="image/*" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="button-container">
                            <button type="submit" class="btn btn-success">ë©¤ë²„ ì¶”ê°€</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- íŒ€ ë©¤ë²„ ëª©ë¡ -->
            <div class="admin-section">
                <h2 class="section-title">ë“±ë¡ëœ íŒ€ ë©¤ë²„</h2>
                <div id="membersLoader" class="hidden" style="text-align: center; padding: 20px;">
                    <div class="loading"></div> ë©¤ë²„ ë¡œë”© ì¤‘...
                </div>
                <table class="project-table">
                    <thead>
                        <tr>
                            <th>ì´ë¦„</th>
                            <th>ì§ì±…</th>
                            <th>ì´ë©”ì¼</th>
                            <th>ì´ë¯¸ì§€</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody id="membersList">
                        <!-- íŒ€ ë©¤ë²„ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ê´€ë¦¬ì ì¸ì¦ ì •ë³´ (ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨)
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: '1234'
        };

        let isLoggedIn = false;
        let editingProjectId = null;
        let editingProjectName = null;
        
        // Firebase ìƒíƒœ ì²´í¬
        let isFirebaseReady = false;

        // Firebase ì¤€ë¹„ ìƒíƒœ í™•ì¸
        function checkFirebaseReady() {
            return new Promise((resolve) => {
                console.log('Firebase ì¤€ë¹„ ìƒíƒœ í™•ì¸ ì‹œì‘');
                console.log('window.db:', window.db);
                console.log('window.firestoreFunctions:', window.firestoreFunctions);
                
                // ì¦‰ì‹œ í™•ì¸
                if (window.db && window.firestoreFunctions) {
                    isFirebaseReady = true;
                    console.log('Firebase ì¦‰ì‹œ ì¤€ë¹„ ì™„ë£Œ!');
                    updateFirebaseStatus(true);
                    resolve(true);
                    return;
                }
                
                const checkInterval = setInterval(() => {
                    if (window.db && window.firestoreFunctions) {
                        clearInterval(checkInterval);
                        isFirebaseReady = true;
                        console.log('Firebase ì¤€ë¹„ ì™„ë£Œ!');
                        updateFirebaseStatus(true);
                        resolve(true);
                    }
                }, 100);
                
                // 10ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ
                setTimeout(() => {
                    clearInterval(checkInterval);
                    if (!isFirebaseReady) {
                        console.log('Firebase ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ');
                        updateFirebaseStatus(false, 'Firebase ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ');
                        resolve(false);
                    }
                }, 10000);
            });
        }

        // Firebase ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateFirebaseStatus(connected, errorMsg = '') {
            const statusElement = document.getElementById('firebaseStatus');
            if (connected) {
                statusElement.className = 'firebase-status firebase-connected';
                statusElement.textContent = 'ğŸ”¥ Firebase ì—°ê²°ë¨ - ì˜¨ë¼ì¸ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© ì¤‘';
            } else {
                statusElement.className = 'firebase-status firebase-error';
                statusElement.textContent = `âŒ Firebase ì—°ê²° ì‹¤íŒ¨: ${errorMsg || 'Firebase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”'}`;
            }
        }

        // Firestore ë³´ì•ˆ ê·œì¹™ ì•ˆë‚´
        function showFirestoreRulesHelp() {
            const helpText = `
Firestore ë³´ì•ˆ ê·œì¹™ ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
Firebase Console > Firestore Database > Rulesì—ì„œ ë‹¤ìŒ ê·œì¹™ì„ ì„¤ì •í•´ì£¼ì„¸ìš”:

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}

âš ï¸ ì£¼ì˜: ì´ ê·œì¹™ì€ ëª¨ë“  ì ‘ê·¼ì„ í—ˆìš©í•©ë‹ˆë‹¤. í”„ë¡œë•ì…˜ì—ì„œëŠ” ë” ì—„ê²©í•œ ê·œì¹™ì„ ì‚¬ìš©í•˜ì„¸ìš”.
            `;
            console.log(helpText);
            showAlert('Firestore ë³´ì•ˆ ê·œì¹™ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ì½˜ì†”ì—ì„œ ìì„¸í•œ ì•ˆë‚´ë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'error');
        }

        // Firestoreì—ì„œ í”„ë¡œì íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ê°„ì†Œí™” ë²„ì „)
        async function getProjects() {
            if (!isFirebaseReady) {
                console.log('Firebaseê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return {};
            }

            try {
                const { collection, getDocs } = window.firestoreFunctions;
                
                // ê°„ë‹¨í•œ ì»¬ë ‰ì…˜ ì½ê¸°ë¡œ ë³€ê²½ (orderBy ì œê±°)
                const querySnapshot = await getDocs(collection(window.db, "projects"));
                
                const projects = {};
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    projects[data.name] = {
                        id: doc.id,
                        ...data
                    };
                });
                
                console.log('Firestoreì—ì„œ í”„ë¡œì íŠ¸ ê°€ì ¸ì˜¤ê¸° ì„±ê³µ:', Object.keys(projects).length + 'ê°œ');
                return projects;
            } catch (error) {
                console.error('Firestore í”„ë¡œì íŠ¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                console.error('ì—ëŸ¬ ì„¸ë¶€ì‚¬í•­:', error);
                
                // ì—ëŸ¬ê°€ ê¶Œí•œ ê´€ë ¨ì¸ì§€ í™•ì¸
                if (error.code === 'permission-denied') {
                    showAlert('Firestore ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë³´ì•ˆ ê·œì¹™ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                } else {
                    showAlert('í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
                return {};
            }
        }

        // ê°œë³„ í”„ë¡œì íŠ¸ ì €ì¥
        async function saveProjectToFirestore(projectData) {
            if (!isFirebaseReady) {
                throw new Error('Firebaseê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }

            try {
                const { collection, addDoc } = window.firestoreFunctions;
                
                // ìƒì„± ì‹œê°„ ì¶”ê°€
                projectData.createdAt = new Date();
                projectData.updatedAt = new Date();
                
                console.log('Firestore ì €ì¥ ì‹œë„ - ì»¬ë ‰ì…˜: projects');
                console.log('ë°ì´í„° í¬ê¸°:', JSON.stringify(projectData).length, 'bytes');
                console.log('ë„¤íŠ¸ì›Œí¬ ìƒíƒœ:', navigator.onLine);
                console.log('Firebase ì—°ê²° ìƒíƒœ:', isFirebaseReady);
                console.log('window.db:', window.db);
                console.log('window.firestoreFunctions:', window.firestoreFunctions);
                
                const docRef = await addDoc(collection(window.db, "projects"), projectData);
                console.log('Firestore í”„ë¡œì íŠ¸ ì €ì¥ ì„±ê³µ. ë¬¸ì„œ ID:', docRef.id);
                return docRef.id;
            } catch (error) {
                console.error('Firestore í”„ë¡œì íŠ¸ ì €ì¥ ì‹¤íŒ¨:', error);
                console.error('ì—ëŸ¬ ì½”ë“œ:', error.code);
                console.error('ì—ëŸ¬ ë©”ì‹œì§€:', error.message);
                console.error('ì—ëŸ¬ ìŠ¤íƒ:', error.stack);
                
                // ê¶Œí•œ ê´€ë ¨ ì—ëŸ¬ì¸ì§€ í™•ì¸
                if (error.code === 'permission-denied') {
                    showFirestoreRulesHelp();
                    throw new Error('Firestore ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë³´ì•ˆ ê·œì¹™ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                } else if (error.code === 'resource-exhausted') {
                    throw new Error('Firestore ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                } else if (error.code === 'invalid-argument') {
                    throw new Error('ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.');
                } else if (error.code === 'unavailable') {
                    throw new Error('Firestore ì„œë¹„ìŠ¤ê°€ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                } else if (error.code === 'deadline-exceeded') {
                    throw new Error('ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
                throw error;
            }
        }

        // í”„ë¡œì íŠ¸ ì—…ë°ì´íŠ¸
        async function updateProjectInFirestore(projectId, projectData) {
            if (!isFirebaseReady) {
                throw new Error('Firebaseê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }

            try {
                const { doc, updateDoc } = window.firestoreFunctions;
                
                // ì—…ë°ì´íŠ¸ ì‹œê°„ ì¶”ê°€
                projectData.updatedAt = new Date();
                
                await updateDoc(doc(window.db, "projects", projectId), projectData);
                console.log('Firestore í”„ë¡œì íŠ¸ ì—…ë°ì´íŠ¸ ì„±ê³µ. ë¬¸ì„œ ID:', projectId);
            } catch (error) {
                console.error('Firestore í”„ë¡œì íŠ¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // í”„ë¡œì íŠ¸ ì‚­ì œ
        async function deleteProjectFromFirestore(projectId) {
            if (!isFirebaseReady) {
                throw new Error('Firebaseê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }

            try {
                const { doc, deleteDoc } = window.firestoreFunctions;
                await deleteDoc(doc(window.db, "projects", projectId));
                console.log('Firestore í”„ë¡œì íŠ¸ ì‚­ì œ ì„±ê³µ. ë¬¸ì„œ ID:', projectId);
            } catch (error) {
                console.error('Firestore í”„ë¡œì íŠ¸ ì‚­ì œ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
        function showAlert(message, type = 'success') {
            const alertElement = document.getElementById('alertMessage');
            alertElement.textContent = message;
            alertElement.className = `alert alert-${type}`;
            alertElement.classList.remove('hidden');
            
            setTimeout(() => {
                alertElement.classList.add('hidden');
            }, 5000);
        }

        // ë¡œë”© ìƒíƒœ í† ê¸€ (ê°„ì†Œí™”)
        function toggleSubmitLoading(loading) {
            const submitBtn = document.getElementById('submitBtn');
            
            if (loading) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
            } else {
                submitBtn.disabled = false;
                submitBtn.textContent = editingProjectName ? 'í”„ë¡œì íŠ¸ ìˆ˜ì •' : 'í”„ë¡œì íŠ¸ ì¶”ê°€';
            }
        }

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isLoggedIn = true;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                
                // Firebase ì¤€ë¹„ í™•ì¸ í›„ í”„ë¡œì íŠ¸ì™€ ë©¤ë²„ ë¡œë“œ
                checkFirebaseReady().then(() => {
                    loadProjects();
                    loadMembers(); // íŒ€ ë©¤ë²„ ëª©ë¡ë„ í•¨ê»˜ ë¡œë“œ
                });
            } else {
                const loginAlert = document.getElementById('loginAlert');
                loginAlert.textContent = 'ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.';
                loginAlert.classList.remove('hidden');
            }
        });

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        document.getElementById('logoutBtn').addEventListener('click', function() {
            isLoggedIn = false;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginAlert').classList.add('hidden');
        });

        // ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ê´€ë¦¬ ë³€ìˆ˜
        let slideImages = [];
        let additionalImages = []; // ì¶”ê°€ ì´ë¯¸ì§€ ë°°ì—´ ì¶”ê°€
        let draggedElement = null;

        // ì´ë¯¸ì§€ë¥¼ base64ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // compressImage í•¨ìˆ˜ - 1MB ì œí•œ ë‚´ì—ì„œ ìµœëŒ€ í™”ì§ˆë¡œ ìë™ ì••ì¶•
        async function compressImage(file, maxWidth = 1200, quality = 1.0) {
            const minQuality = 0.5;
            const minWidth = 600;
            let curQuality = quality;
            let curWidth = maxWidth;
            let compressedDataUrl = null;
            let sizeInKB = 0;
            
            while (curWidth >= minWidth) {
                curQuality = quality;
                while (curQuality >= minQuality) {
                    compressedDataUrl = await new Promise((resolve) => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const img = new Image();
                        img.onload = () => {
                            const ratio = Math.min(curWidth / img.width, curWidth / img.height);
                            canvas.width = img.width * ratio;
                            canvas.height = img.height * ratio;
                            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                            resolve(canvas.toDataURL('image/jpeg', curQuality));
                        };
                        img.src = URL.createObjectURL(file);
                    });
                    sizeInKB = (compressedDataUrl.length * 0.75) / 1024;
                    if (sizeInKB <= 1024) {
                        console.log(`ì´ë¯¸ì§€ ì••ì¶• ì™„ë£Œ: ${sizeInKB.toFixed(2)}KB (í•´ìƒë„: ${curWidth}px, í™”ì§ˆ: ${curQuality * 100}%)`);
                        return compressedDataUrl;
                    }
                    curQuality -= 0.1;
                }
                curWidth -= 200;
            }
            // ë§ˆì§€ë§‰ ì‹œë„(ìµœì†Œ í•´ìƒë„, ìµœì†Œ í’ˆì§ˆ)
            console.warn('1MB ì´í•˜ë¡œ ì••ì¶• ë¶ˆê°€, ìµœì € í™”ì§ˆë¡œ ì €ì¥');
            return compressedDataUrl;
        }

        // ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ìë™ ì¶”ê°€ í•¨ìˆ˜ ìˆ˜ì • (ìµœëŒ€ 3ê°œ ì œí•œ)
        document.getElementById('slideImages').addEventListener('change', async function() {
            const files = this.files;
            
            if (files.length === 0) return;
            
            // ê°œìˆ˜ ì œí•œ ì—†ì´ ëª¨ë‘ ì¶”ê°€
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const imageId = Date.now() + '-slide-' + i;
                
                try {
                    // ì´ë¯¸ì§€ ì••ì¶• í›„ base64ë¡œ ë³€í™˜ (ìµœëŒ€ í™”ì§ˆ)
                    const compressedBase64 = await compressImage(file, 1200, 1.0);
                    
                    slideImages.push({
                        id: imageId,
                        file: file,
                        url: compressedBase64 // base64 URL ì €ì¥
                    });
                    
                    console.log('ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ì••ì¶• ì™„ë£Œ:', (compressedBase64.length / 1024).toFixed(2) + 'KB');
                } catch (error) {
                    console.error('ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    alert('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + file.name);
                }
            }
            
            renderSlidePreview();
            this.value = ''; // ê°™ì€ íŒŒì¼ì„ ë‹¤ì‹œ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ì´ˆê¸°í™”
        });

        // ì¶”ê°€ ì´ë¯¸ì§€ ìë™ ì¶”ê°€ í•¨ìˆ˜ ìˆ˜ì •
        document.getElementById('additionalImages').addEventListener('change', async function() {
            const files = this.files;
            
            if (files.length === 0) return;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const imageId = Date.now() + '-additional-' + i;
                
                try {
                    // ì´ë¯¸ì§€ ì••ì¶• í›„ base64ë¡œ ë³€í™˜ (1MB ì œí•œì„ ìœ„í•œ ê°•í•œ ì••ì¶•)
                    const compressedBase64 = await compressImage(file, 600, 0.5);
                    
                    additionalImages.push({
                        id: imageId,
                        file: file,
                        url: compressedBase64 // base64 URL ì €ì¥
                    });
                    
                    console.log('ì¶”ê°€ ì´ë¯¸ì§€ ì••ì¶• ì™„ë£Œ:', (compressedBase64.length / 1024).toFixed(2) + 'KB');
                } catch (error) {
                    console.error('ì¶”ê°€ ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    alert('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + file.name);
                }
            }
            
            renderAdditionalPreview();
            this.value = ''; // ê°™ì€ íŒŒì¼ì„ ë‹¤ì‹œ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ì´ˆê¸°í™”
        });

        // ìŠ¬ë¼ì´ë“œ ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§
        function renderSlidePreview() {
            const container = document.getElementById('slidePreviewContainer');
            
            if (slideImages.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; margin: 20px 0;">ì„ íƒëœ ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            container.innerHTML = slideImages.map((img, index) => `
                <div class="slide-preview-item" draggable="true" data-id="${img.id}" data-index="${index}">
                    <img src="${img.url}" alt="ìŠ¬ë¼ì´ë“œ ${index + 1}" class="slide-preview-img">
                    <div class="slide-preview-controls">
                        <button type="button" class="slide-control-btn delete-slide-btn" onclick="removeSlideImage('${img.id}')">Ã—</button>
                    </div>
                </div>
            `).join('');
            
            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ì¶”ê°€
            addDragDropEvents();
        }

        // ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ì‚­ì œ
        function removeSlideImage(imageId) {
            slideImages = slideImages.filter(img => img.id !== imageId);
            renderSlidePreview();
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
        function addDragDropEvents() {
            const items = document.querySelectorAll('.slide-preview-item');
            
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
            });
        }

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            
            if (this !== draggedElement) {
                const draggedIndex = parseInt(draggedElement.dataset.index);
                const targetIndex = parseInt(this.dataset.index);
                
                // ë°°ì—´ì—ì„œ ìœ„ì¹˜ ë³€ê²½
                const draggedItem = slideImages[draggedIndex];
                slideImages.splice(draggedIndex, 1);
                slideImages.splice(targetIndex, 0, draggedItem);
                
                renderSlidePreview();
            }
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedElement = null;
        }

        // í”„ë¡œì íŠ¸ ì €ì¥ í•¨ìˆ˜ ìˆ˜ì •
        function saveProject() {
            const form = document.getElementById('projectForm');
            const formData = new FormData(form);
            
            // ê¸°ë³¸ í”„ë¡œì íŠ¸ ì •ë³´
            const projectData = {
                id: formData.get('projectId'),
                name: formData.get('projectName'),
                number: formData.get('projectNumber'),
                category: formData.get('projectCategory'),
                year: formData.get('projectYear'),
                location: formData.get('projectLocation'),
                size: formData.get('projectSize'),
                description: formData.get('projectDescription'),
                mainImage: '', // ë©”ì¸ ì´ë¯¸ì§€ URL
                slideImages: [] // ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ URLs
            };
            
            // ë©”ì¸ ì´ë¯¸ì§€ ì²˜ë¦¬
            const mainImageFile = formData.get('projectImage');
            if (mainImageFile && mainImageFile.size > 0) {
                projectData.mainImage = URL.createObjectURL(mainImageFile);
            }
            
            // ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ë“¤ ì²˜ë¦¬
            projectData.slideImages = slideImages.map(img => img.url);
            
            // localStorageì— ì €ì¥
            let projects = JSON.parse(localStorage.getItem('projects') || '[]');
            
            // ê¸°ì¡´ í”„ë¡œì íŠ¸ ì—…ë°ì´íŠ¸ ë˜ëŠ” ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€
            const existingIndex = projects.findIndex(p => p.id === projectData.id);
            if (existingIndex !== -1) {
                projects[existingIndex] = projectData;
                alert('í”„ë¡œì íŠ¸ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                projects.push(projectData);
                alert('í”„ë¡œì íŠ¸ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
            
            localStorage.setItem('projects', JSON.stringify(projects));
            
            // í¼ ì´ˆê¸°í™”
            form.reset();
            slideImages = [];
            renderSlidePreview();
            
            loadProjects(); // í”„ë¡œì íŠ¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” - ê°„ì†Œí™”
        document.addEventListener('DOMContentLoaded', function() {
            renderSlidePreview();
            renderAdditionalPreview();
            
            // Firebase ì´ˆê¸°í™” ì²´í¬
            checkFirebaseReady();
            
            console.log('ê´€ë¦¬ì í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ'); // ë””ë²„ê¹…ìš©
        });

        // ìˆ˜ì • ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬ (ë¡œë”© ìƒíƒœ ê´€ë¦¬)
        async function handleEditProject(buttonElement, projectName) {
            const originalText = buttonElement.textContent;
            buttonElement.disabled = true;
            buttonElement.textContent = 'ë¡œë”©...';
            
            try {
                await editProject(projectName);
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ìˆ˜ì • ì‹¤íŒ¨:', error);
                showAlert('í”„ë¡œì íŠ¸ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            } finally {
                buttonElement.disabled = false;
                buttonElement.textContent = originalText;
            }
        }

        // í”„ë¡œì íŠ¸ ìˆ˜ì • í•¨ìˆ˜ ìˆ˜ì • (ë¡œë”© ë¬¸ì œ í•´ê²°)
        async function editProject(projectName) {
            try {
                // Firebaseê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìœ¼ë©´ localStorageì—ì„œ ê°€ì ¸ì˜¤ê¸°
                let firestoreProjects = {};
                
                if (isFirebaseReady) {
                    // íƒ€ì„ì•„ì›ƒ ì„¤ì • (3ì´ˆ)
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('íƒ€ì„ì•„ì›ƒ')), 3000)
                    );
                    
                    try {
                        firestoreProjects = await Promise.race([getProjects(), timeoutPromise]);
                    } catch (error) {
                        console.log('Firestoreì—ì„œ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨, localStorage ì‚¬ìš©:', error.message);
                        // Firestore ì‹¤íŒ¨ì‹œ localStorageì—ì„œ ê°€ì ¸ì˜¤ê¸°
                        const localProjects = localStorage.getItem('adminProjects');
                        firestoreProjects = localProjects ? JSON.parse(localProjects) : {};
                    }
                } else {
                    // Firebaseê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìœ¼ë©´ localStorageì—ì„œ ê°€ì ¸ì˜¤ê¸°
                    console.log('Firebase ì¤€ë¹„ë˜ì§€ ì•ŠìŒ, localStorage ì‚¬ìš©');
                    const localProjects = localStorage.getItem('adminProjects');
                    firestoreProjects = localProjects ? JSON.parse(localProjects) : {};
                }
                
                const project = firestoreProjects[projectName];
                
                if (!project) {
                    console.log('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', projectName);
                    showAlert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                console.log('ìˆ˜ì •í•  í”„ë¡œì íŠ¸ ë°ì´í„°:', project);

                editingProjectId = project.id;
                editingProjectName = projectName;
                
                // ê¸°ë³¸ ì •ë³´ ì…ë ¥
                document.getElementById('projectName').value = project.name || '';
                document.getElementById('projectCategory').value = project.category || '';
                document.getElementById('projectLocation').value = project.location || '';
                document.getElementById('projectYear').value = project.year || '';
                document.getElementById('projectStatus').value = project.status || 'In Planning';
                document.getElementById('projectDeveloper').value = project.developer || '';
                document.getElementById('projectManager').value = project.manager || '';
                document.getElementById('projectPlanning').value = project.planning || '';
                document.getElementById('projectStructure').value = project.structure || '';
                document.getElementById('projectInterior').value = project.interior || 'THE HOON STUDIO';
                
                // ìˆ˜ì • ëª¨ë“œì—ì„œëŠ” ë©”ì¸ ì´ë¯¸ì§€ required ì†ì„± ì œê±°
                const mainImageInput = document.getElementById('projectImage');
                mainImageInput.removeAttribute('required');
                
                // ë©”ì¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
                const mainImagePreview = document.getElementById('mainImagePreview');
                if (project.image) {
                    const img = document.createElement('img');
                    img.src = project.image;
                    img.alt = 'ë©”ì¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°';
                    mainImagePreview.innerHTML = '';
                    mainImagePreview.appendChild(img);
                    
                    // ê¸°ì¡´ ì´ë¯¸ì§€ë¥¼ datasetì— ì €ì¥ (í¼ ì œì¶œ ì‹œ ì‚¬ìš©)
                    mainImagePreview.dataset.compressedImage = project.image;
                } else {
                    mainImagePreview.innerHTML = '';
                    delete mainImagePreview.dataset.compressedImage;
                }
                
                // ìƒì„¸ ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ë“¤ ë¶ˆëŸ¬ì˜¤ê¸°
                slideImages = [];
                if (project.images && Array.isArray(project.images)) {
                    project.images.forEach((imageUrl, index) => {
                        slideImages.push({
                            id: 'existing-slide-' + index,
                            file: null,
                            url: imageUrl
                        });
                    });
                }
                renderSlidePreview();
                
                // ì¶”ê°€ ì´ë¯¸ì§€ë“¤ ë¶ˆëŸ¬ì˜¤ê¸°
                additionalImages = [];
                if (project.additionalImages && Array.isArray(project.additionalImages)) {
                    project.additionalImages.forEach((imageUrl, index) => {
                        additionalImages.push({
                            id: 'existing-additional-' + index,
                            file: null,
                            url: imageUrl
                        });
                    });
                }
                renderAdditionalPreview();
                
                // ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ì±„ìš°ê¸° (ë°°ì—´/ë¬¸ìì—´ ëª¨ë‘ ëŒ€ì‘)
                const checkboxes = document.querySelectorAll('input[name="projectCategories"]');
                checkboxes.forEach(cb => cb.checked = false);
                let categories = project.category;
                if (!Array.isArray(categories)) {
                    categories = categories ? [categories] : [];
                }
                categories.forEach(cat => {
                    const checkbox = document.querySelector(`input[name="projectCategories"][value="${cat}"]`);
                    if (checkbox) checkbox.checked = true;
                });
                
                // í•˜ì´ë¼ì´íŠ¸ ì²´í¬ë°•ìŠ¤ ì œê±°ë¨

                // ìˆ˜ì • ëª¨ë“œ UI í‘œì‹œ
                document.getElementById('cancelEdit').classList.remove('hidden');
                
                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.textContent = 'í”„ë¡œì íŠ¸ ìˆ˜ì •';
                
                // í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                document.querySelector('.admin-section').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ìˆ˜ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                showAlert('í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ìˆ˜ì • ì·¨ì†Œ ë²„íŠ¼ ìˆ˜ì •
        document.getElementById('cancelEdit').addEventListener('click', function() {
            editingProjectId = null;
            editingProjectName = null;
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('projectForm').reset();
            
            // ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€ ëª¨ë“œë¡œ ëŒì•„ê°ˆ ë•Œ required ì†ì„± ë‹¤ì‹œ ì¶”ê°€
            const mainImageInput = document.getElementById('projectImage');
            mainImageInput.setAttribute('required', 'required');
            
            // ì´ë¯¸ì§€ ë°°ì—´ ì´ˆê¸°í™”
            slideImages = [];
            additionalImages = [];
            
            // ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
            renderSlidePreview();
            renderAdditionalPreview();
            document.getElementById('mainImagePreview').innerHTML = '';
            
            // UI ì´ˆê¸°í™”
            this.classList.add('hidden');
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.textContent = 'í”„ë¡œì íŠ¸ ì¶”ê°€';
        });

        // í”„ë¡œì íŠ¸ í¼ ì œì¶œ ì²˜ë¦¬ - Firebase ë²„ì „
        document.getElementById('projectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            toggleSubmitLoading(true);
            
            console.log('=== í”„ë¡œì íŠ¸ ì €ì¥ ì‹œì‘ ===');
            console.log('Firebase ìƒíƒœ:', isFirebaseReady);
            console.log('ë¡œê·¸ì¸ ìƒíƒœ:', isLoggedIn);
            console.log('window.db:', window.db);
            console.log('window.firestoreFunctions:', window.firestoreFunctions);
            
            try {
                // í¼ ë°ì´í„° ìˆ˜ì§‘
                const projectName = document.getElementById('projectName').value;
                const projectCategory = document.getElementById('projectCategory').value;
                const projectLocation = document.getElementById('projectLocation').value;
                const projectYear = document.getElementById('projectYear').value;
                const projectStatus = document.getElementById('projectStatus').value;
                const projectDeveloper = document.getElementById('projectDeveloper').value;
                const projectManager = document.getElementById('projectManager').value;
                const projectPlanning = document.getElementById('projectPlanning').value;
                const projectStructure = document.getElementById('projectStructure').value;
                const projectInterior = document.getElementById('projectInterior').value;
                
                // ë©”ì¸ ì´ë¯¸ì§€ ì²˜ë¦¬
                let mainImageUrl = '';
                const mainImageFile = document.getElementById('projectImage').files[0];
                const previewContainer = document.getElementById('mainImagePreview');
                
                if (mainImageFile) {
                    // ìƒˆë¡œìš´ ì´ë¯¸ì§€ê°€ ì„ íƒëœ ê²½ìš°
                    mainImageUrl = await compressImage(mainImageFile, 600, 0.5);
                    console.log('ìƒˆ ë©”ì¸ ì´ë¯¸ì§€ ì••ì¶• ì™„ë£Œ');
                } else if (previewContainer.dataset.compressedImage) {
                    // ê¸°ì¡´ ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš° (ìˆ˜ì • ëª¨ë“œì—ì„œ ìƒˆ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì§€ ì•Šì•˜ì„ ë•Œ)
                    mainImageUrl = previewContainer.dataset.compressedImage;
                    console.log('ê¸°ì¡´ ë©”ì¸ ì´ë¯¸ì§€ ì‚¬ìš©');
                } else if (!editingProjectName) {
                    // ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€ ëª¨ë“œì¸ë° ì´ë¯¸ì§€ê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì—ëŸ¬
                    throw new Error('ë©”ì¸ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }
                
                // ìƒì„¸ ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ë“¤
                const detailSlideImages = slideImages.map(img => img.url);
                
                // ì¶”ê°€ ì´ë¯¸ì§€ë“¤
                const additionalSlideImages = additionalImages.map(img => img.url);
                
                console.log('ì²˜ë¦¬ëœ ì´ë¯¸ì§€ ë°ì´í„°:');
                console.log('ë©”ì¸ ì´ë¯¸ì§€ í¬ê¸°:', mainImageUrl ? (mainImageUrl.length / 1024).toFixed(2) + 'KB' : 'ì—†ìŒ');
                console.log('ìƒì„¸ ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ìˆ˜:', detailSlideImages.length);
                console.log('ì¶”ê°€ ì´ë¯¸ì§€ ìˆ˜:', additionalSlideImages.length);
                
                // í”„ë¡œì íŠ¸ ë°ì´í„° ìƒì„±
                const projectData = {
                    name: projectName,
                    category: projectCategory,
                    location: projectLocation,
                    year: projectYear ? parseInt(projectYear) : null,
                    status: projectStatus,
                    developer: projectDeveloper,
                    manager: projectManager,
                    planning: projectPlanning,
                    structure: projectStructure,
                    interior: projectInterior,
                    
                    // ì´ë¯¸ì§€ë“¤ (ëª¨ë‘ base64 í˜•íƒœë¡œ ì €ì¥)
                    mainImage: mainImageUrl,                    // ë©”ì¸ ì´ë¯¸ì§€ (í•„ë“œëª… ë³€ê²½)
                    images: detailSlideImages,              // ìƒì„¸ ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ë“¤
                    additionalImages: additionalSlideImages // ì¶”ê°€ ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ë“¤
                };
                // ì„¸ë¶€ì¹´í…Œê³ ë¦¬(ì²´í¬ë°•ìŠ¤) ê°’ ì €ì¥
                projectData.categoryDetail = Array.from(document.querySelectorAll('input[name="projectCategories"]:checked')).map(cb => cb.value);

                // í•˜ì´ë¼ì´íŠ¸ ì²´í¬ë°•ìŠ¤ ì œê±°ë¨ - ëª¨ë“  í”„ë¡œì íŠ¸ê°€ í•˜ì´ë¼ì´íŠ¸ì— í‘œì‹œë¨

                // Firebase ë˜ëŠ” localStorage ì €ì¥
                try {
                    console.log('ì €ì¥ ì‹œë„ - Firebase ì¤€ë¹„:', isFirebaseReady, 'ìˆ˜ì • ëª¨ë“œ:', editingProjectId);
                    console.log('í”„ë¡œì íŠ¸ ë°ì´í„° í¬ê¸°:', JSON.stringify(projectData).length, 'bytes');
                    
                    if (isFirebaseReady && editingProjectId) {
                        // Firebase ìˆ˜ì • ëª¨ë“œ
                        console.log('Firebase ìˆ˜ì • ëª¨ë“œë¡œ ì €ì¥ ì‹œë„');
                        await updateProjectInFirestore(editingProjectId, projectData);
                        showAlert('í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else if (isFirebaseReady) {
                        // Firebase ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€
                        console.log('Firebase ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€ ì‹œë„');
                        const docId = await saveProjectToFirestore(projectData);
                        showAlert('í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        // Firebase ì—°ê²° ì•ˆë¨ - localStorageë§Œ ì‚¬ìš©
                        console.log('Firebase ì—°ê²° ì•ˆë¨, localStorage ì‚¬ìš©');
                        console.log('Firebase ì¤€ë¹„ ìƒíƒœ:', isFirebaseReady);
                        console.log('window.db:', window.db);
                        console.log('window.firestoreFunctions:', window.firestoreFunctions);
                        
                        // localStorageì— ì €ì¥
                        let localProjects = JSON.parse(localStorage.getItem('adminProjects') || '{}');
                        let projectsArray = JSON.parse(localStorage.getItem('projects') || '[]');
                        
                        if (editingProjectName) {
                            // ìˆ˜ì • ëª¨ë“œ
                            delete localProjects[editingProjectName];
                            projectsArray = projectsArray.filter(p => p.name !== editingProjectName);
                        }
                        
                        // ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€
                        localProjects[projectData.name] = projectData;
                        projectsArray.push(projectData);
                        
                        localStorage.setItem('adminProjects', JSON.stringify(localProjects));
                        localStorage.setItem('projects', JSON.stringify(projectsArray));
                        
                        showAlert('í”„ë¡œì íŠ¸ê°€ ë¡œì»¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (Firebase ì—°ê²° í›„ ë™ê¸°í™”ë©ë‹ˆë‹¤)', 'success');
                    }
                } catch (firebaseError) {
                    console.error('Firebase ì €ì¥ ì‹¤íŒ¨, localStorage ì‚¬ìš©:', firebaseError);
                    console.error('Firebase ì—ëŸ¬ ìƒì„¸:', firebaseError);
                    console.error('ì—ëŸ¬ ì½”ë“œ:', firebaseError.code);
                    console.error('ì—ëŸ¬ ë©”ì‹œì§€:', firebaseError.message);
                    console.error('ì—ëŸ¬ ìŠ¤íƒ:', firebaseError.stack);
                    
                    // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
                    console.log('ë„¤íŠ¸ì›Œí¬ ìƒíƒœ:', navigator.onLine);
                    console.log('Firebase ì—°ê²° ìƒíƒœ:', isFirebaseReady);
                    
                    // Firebase ì‹¤íŒ¨ì‹œ localStorageì— ì €ì¥ (ìš©ëŸ‰ ì œí•œ ê³ ë ¤)
                    try {
                        let localProjects = JSON.parse(localStorage.getItem('adminProjects') || '{}');
                        let projectsArray = JSON.parse(localStorage.getItem('projects') || '[]');
                        
                        if (editingProjectName) {
                            delete localProjects[editingProjectName];
                            projectsArray = projectsArray.filter(p => p.name !== editingProjectName);
                        }
                        
                        localProjects[projectData.name] = projectData;
                        projectsArray.push(projectData);
                        
                        localStorage.setItem('adminProjects', JSON.stringify(localProjects));
                        localStorage.setItem('projects', JSON.stringify(projectsArray));
                    } catch (localStorageError) {
                        console.error('localStorage ì €ì¥ ì‹¤íŒ¨:', localStorageError);
                        showAlert('localStorage ìš©ëŸ‰ ë¶€ì¡±ìœ¼ë¡œ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ë°ì´í„°ë¥¼ ì •ë¦¬í•´ì£¼ì„¸ìš”.', 'error');
                    }
                    
                    let errorMessage = firebaseError.message;
                    if (firebaseError.code === 'permission-denied') {
                        errorMessage = 'Firestore ê¶Œí•œ ë¬¸ì œ - ë³´ì•ˆ ê·œì¹™ì„ í™•ì¸í•´ì£¼ì„¸ìš”';
                    } else if (firebaseError.code === 'resource-exhausted') {
                        errorMessage = 'Firestore ì €ì¥ê³µê°„ ë¶€ì¡±';
                    }
                    
                    showAlert('Firebase ì €ì¥ ì‹¤íŒ¨, ë¡œì»¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (ì—ëŸ¬: ' + errorMessage + ')', 'success');
                }
                
                // ìˆ˜ì • ëª¨ë“œ ì •ë¦¬
                if (editingProjectName) {
                    editingProjectId = null;
                    editingProjectName = null;
                    document.getElementById('cancelEdit').classList.add('hidden');
                    const submitBtn = document.getElementById('submitBtn');
                    submitBtn.textContent = 'í”„ë¡œì íŠ¸ ì¶”ê°€';
                    
                    // required ì†ì„± ë‹¤ì‹œ ì¶”ê°€
                    const mainImageInput = document.getElementById('projectImage');
                    mainImageInput.setAttribute('required', 'required');
                }
                
                console.log('=== í”„ë¡œì íŠ¸ ì €ì¥ ì„±ê³µ ===');
                
                // í”„ë¡œì íŠ¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                loadProjects();
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('projectForm').reset();
                slideImages = [];
                additionalImages = [];
                renderSlidePreview();
                renderAdditionalPreview();
                document.getElementById('mainImagePreview').innerHTML = '';
                
                // ì‹¤ì‹œê°„ ë°˜ì˜
                window.dispatchEvent(new Event('adminProjectsUpdated'));
                
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ì €ì¥ ì‹¤íŒ¨:', error);
                
                if (error.message.includes('quota') || error.message.includes('storage')) {
                    showAlert('Firestore ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ë” ì¤„ì´ê±°ë‚˜ ê¸°ì¡´ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.', 'error');
                } else {
                    showAlert('í”„ë¡œì íŠ¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            } finally {
                toggleSubmitLoading(false);
            }
        });

        // Firestore ë°ì´í„°ë¥¼ localStorageì— ë™ê¸°í™” (ê¸°ì¡´ í”„ë¡œì íŠ¸ í˜ì´ì§€ í˜¸í™˜ì„±ì„ ìœ„í•´)
        async function syncToLocalStorage() {
            try {
                const firestoreProjects = await getProjects();
                const projectsArray = Object.values(firestoreProjects);
                
                localStorage.setItem('projects', JSON.stringify(projectsArray));
                localStorage.setItem('adminProjects', JSON.stringify(firestoreProjects));
                
                // í”„ë¡œì íŠ¸ í˜ì´ì§€ì— ì‹¤ì‹œê°„ ë°˜ì˜
                window.dispatchEvent(new Event('adminProjectsUpdated'));
                
                console.log('localStorage ë™ê¸°í™” ì™„ë£Œ:', projectsArray.length + 'ê°œ í”„ë¡œì íŠ¸');
            } catch (error) {
                console.error('localStorage ë™ê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // í”„ë¡œì íŠ¸ ëª©ë¡ ë¡œë“œ - Firebase/localStorage í•˜ì´ë¸Œë¦¬ë“œ
        async function loadProjects() {
            const projectList = document.getElementById('projectList');
            const loader = document.getElementById('projectsLoader');
            
            try {
                loader.classList.remove('hidden');
                projectList.innerHTML = '';

                let projects = {};
                
                if (isFirebaseReady) {
                    try {
                        projects = await getProjects();
                        console.log('Firebaseì—ì„œ í”„ë¡œì íŠ¸ ë¡œë“œ ì„±ê³µ');
                    } catch (error) {
                        console.log('Firebase ë¡œë“œ ì‹¤íŒ¨, localStorage ì‚¬ìš©:', error);
                        const localProjects = localStorage.getItem('adminProjects');
                        projects = localProjects ? JSON.parse(localProjects) : {};
                    }
                } else {
                    console.log('Firebase ì¤€ë¹„ ì•ˆë¨, localStorage ì‚¬ìš©');
                    const localProjects = localStorage.getItem('adminProjects');
                    projects = localProjects ? JSON.parse(localProjects) : {};
                }
                
                if (Object.keys(projects).length === 0) {
                    projectList.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999;">ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                } else {
                    // í”„ë¡œì íŠ¸ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì •ë ¬
                    const sortedProjects = Object.entries(projects).sort((a, b) => {
                        const categoryA = a[1].category.toLowerCase();
                        const categoryB = b[1].category.toLowerCase();
                        
                        // ì•„í‚¤í…ì²˜ê°€ ë¨¼ì €, ì¸í…Œë¦¬ì–´ê°€ ë‚˜ì¤‘ì— ì˜¤ë„ë¡ ì •ë ¬
                        if (categoryA === 'architecture' && categoryB !== 'architecture') {
                            return -1;
                        }
                        if (categoryA !== 'architecture' && categoryB === 'architecture') {
                            return 1;
                        }
                        
                        // ê°™ì€ ì¹´í…Œê³ ë¦¬ ë‚´ì—ì„œëŠ” ì´ë¦„ìˆœ ì •ë ¬
                        return a[0].localeCompare(b[0]);
                    });
                    
                    sortedProjects.forEach(([projectName, project]) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${project.name}</td>
                            <td>${project.category.toUpperCase()}</td>
                            <td>${project.location}</td>
                            <td>${project.year || '-'}</td>
                            <td>${project.status}</td>
                            <td>
                                <button class="btn-edit" onclick="handleEditProject(this, '${projectName}')">ìˆ˜ì •</button>
                                <button class="btn-danger" onclick="deleteProject('${projectName}', '${project.id}')">ì‚­ì œ</button>
                            </td>
                        `;
                        projectList.appendChild(row);
                    });
                }

                // localStorage ë™ê¸°í™” (ê°„ì†Œí™”)
                const projectsArray = Object.values(projects);
                try {
                    localStorage.setItem('projects', JSON.stringify(projectsArray));
                    localStorage.setItem('adminProjects', JSON.stringify(projects));
                } catch (e) {
                    console.warn('localStorage ìš©ëŸ‰ ì´ˆê³¼, ì €ì¥ì„ ê±´ë„ˆëœë‹ˆë‹¤.', e);
                }
                
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                projectList.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #dc3545;">í”„ë¡œì íŠ¸ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</td></tr>';
                showAlert('í”„ë¡œì íŠ¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            } finally {
                loader.classList.add('hidden');
            }
        }

        // í”„ë¡œì íŠ¸ ì‚­ì œ - Firebase ë²„ì „
        async function deleteProject(projectName, projectId) {
            if (!isFirebaseReady) {
                showAlert('Firebase ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            if (confirm(`"${projectName}" í”„ë¡œì íŠ¸ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                try {
                    await deleteProjectFromFirestore(projectId);
                    showAlert('í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    
                    // í”„ë¡œì íŠ¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    await loadProjects();
                    
                } catch (error) {
                    console.error('í”„ë¡œì íŠ¸ ì‚­ì œ ì‹¤íŒ¨:', error);
                    showAlert('í”„ë¡œì íŠ¸ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            }
        }

        // ë©”ì¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
        document.getElementById('projectImage').addEventListener('change', async function() {
            const file = this.files[0];
            const previewContainer = document.getElementById('mainImagePreview');
            
            if (file) {
                try {
                    // ì´ë¯¸ì§€ ì••ì¶• í›„ base64ë¡œ ë³€í™˜ (1MB ì œí•œì„ ìœ„í•œ ê°•í•œ ì••ì¶•)
                    const compressedBase64 = await compressImage(file, 600, 0.5);
                    
                    const img = document.createElement('img');
                    img.src = compressedBase64;
                    img.alt = 'ë©”ì¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°';
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(img);
                    
                    // ì••ì¶•ëœ ì´ë¯¸ì§€ë¥¼ ì„ì‹œ ì €ì¥ (í¼ ì œì¶œ ì‹œ ì‚¬ìš©)
                    previewContainer.dataset.compressedImage = compressedBase64;
                    
                    console.log('ë©”ì¸ ì´ë¯¸ì§€ ì••ì¶• ì™„ë£Œ:', (compressedBase64.length / 1024).toFixed(2) + 'KB');
                } catch (error) {
                    console.error('ë©”ì¸ ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    alert('ë©”ì¸ ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } else {
                previewContainer.innerHTML = '';
                delete previewContainer.dataset.compressedImage;
            }
        });

        function renderAdditionalPreview() {
            const container = document.getElementById('additionalPreviewContainer');
            
            if (additionalImages.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; margin: 10px 0;">ì¶”ê°€ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            container.innerHTML = additionalImages.map((img, index) => `
                <div class="additional-preview-item" data-id="${img.id}">
                    <img src="${img.url}" alt="ì¶”ê°€ ì´ë¯¸ì§€ ${index + 1}" class="additional-preview-img">
                    <div class="slide-preview-controls">
                        <button type="button" class="slide-control-btn delete-slide-btn" onclick="removeAdditionalImage('${img.id}')">Ã—</button>
                    </div>
                </div>
            `).join('');
        }

        function removeAdditionalImage(imageId) {
            additionalImages = additionalImages.filter(img => img.id !== imageId);
            renderAdditionalPreview();
        }

        // íŒ€ ë©¤ë²„ ëª©ë¡ ë¡œë“œ
        async function loadMembers() {
            const membersList = document.getElementById('membersList');
            const loader = document.getElementById('membersLoader');
            
            try {
                loader.classList.remove('hidden');
                membersList.innerHTML = '';

                if (!isFirebaseReady) {
                    membersList.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">Firebase ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</td></tr>';
                    return;
                }

                const { collection, getDocs, query, orderBy } = window.firestoreFunctions;
                
                // orderBy ì—†ì´ ë¨¼ì € ì‹œë„
                let q;
                try {
                    q = query(collection(window.db, 'team'), orderBy('createdAt', 'desc'));
                } catch (error) {
                    q = query(collection(window.db, 'team'));
                }
                
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    membersList.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">ë“±ë¡ëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                } else {
                    querySnapshot.forEach((doc) => {
                        const member = doc.data();
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${member.name || 'ì´ë¦„ ì—†ìŒ'}</td>
                            <td>${member.position || 'ì§ì±… ì—†ìŒ'}</td>
                            <td>${member.email || 'ì´ë©”ì¼ ì—†ìŒ'}</td>
                            <td>
                                ${member.image ? `<img src="${member.image}" alt="${member.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">` : 'ì´ë¯¸ì§€ ì—†ìŒ'}
                            </td>
                            <td>
                                <button class="btn-edit" onclick="handleEditMember(this, '${doc.id}')">ìˆ˜ì •</button>
                                <button class="btn-danger" onclick="deleteMember('${doc.id}', '${member.name}')">ì‚­ì œ</button>
                            </td>
                        `;
                        membersList.appendChild(row);
                    });
                }
                
            } catch (error) {
                console.error('ë©¤ë²„ ë¡œë“œ ì‹¤íŒ¨:', error);
                membersList.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #dc3545;">ë©¤ë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</td></tr>';
            } finally {
                loader.classList.add('hidden');
            }
        }

        // ë©¤ë²„ ìˆ˜ì • ì²˜ë¦¬
        async function handleEditMember(button, memberId) {
            try {
                const { doc, getDoc } = window.firestoreFunctions;
                const memberDoc = await getDoc(doc(window.db, 'team', memberId));
                
                if (memberDoc.exists()) {
                    const member = memberDoc.data();
                    
                    // í¼ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
                    document.getElementById('memberName').value = member.name || '';
                    document.getElementById('memberPosition').value = member.position || '';
                    document.getElementById('memberEmail').value = member.email || '';
                    
                    // ìˆ˜ì • ëª¨ë“œ í‘œì‹œ
                    const submitBtn = document.querySelector('#memberAddForm button[type="submit"]');
                    submitBtn.textContent = 'ë©¤ë²„ ìˆ˜ì •';
                    
                    // ìˆ˜ì • ì™„ë£Œ í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ ë©¤ë²„ ID ì €ì¥
                    submitBtn.dataset.editingMemberId = memberId;
                    
                    // í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                    document.querySelector('#memberAddForm').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                console.error('ë©¤ë²„ ìˆ˜ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ë©¤ë²„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }



        // ë©¤ë²„ ì‚­ì œ
        async function deleteMember(memberId, memberName) {
            if (confirm(`"${memberName}" ë©¤ë²„ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                try {
                    const { doc, deleteDoc } = window.firestoreFunctions;
                    await deleteDoc(doc(window.db, 'team', memberId));
                    alert('ë©¤ë²„ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    await loadMembers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } catch (error) {
                    console.error('ë©¤ë²„ ì‚­ì œ ì‹¤íŒ¨:', error);
                    alert('ë©¤ë²„ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            }
        }

        // ë©¤ë²„ ì¶”ê°€/ìˆ˜ì • í¼ Firestore ì €ì¥
        document.getElementById('memberAddForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('memberName').value.trim();
            const position = document.getElementById('memberPosition').value.trim();
            const email = document.getElementById('memberEmail').value.trim();
            const imageFile = document.getElementById('memberImage').files[0];
            
            if (!name || !position || !email) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                let imageBase64 = '';
                
                if (imageFile) {
                    // ìƒˆ ì´ë¯¸ì§€ê°€ ì„ íƒëœ ê²½ìš° - 1MB ì œí•œì„ ìœ„í•œ ê°•í•œ ì••ì¶•
                    imageBase64 = await compressImage(imageFile, 500, 0.5);
                }

                const submitBtn = this.querySelector('button[type="submit"]');
                const editingMemberId = submitBtn.dataset.editingMemberId;

                if (editingMemberId) {
                    // ìˆ˜ì • ëª¨ë“œ
                    const { doc, updateDoc } = window.firestoreFunctions;
                    const updateData = {
                        name, position, email,
                        updatedAt: new Date().toISOString()
                    };
                    
                    if (imageBase64) {
                        updateData.image = imageBase64;
                    }
                    
                    await updateDoc(doc(window.db, 'team', editingMemberId), updateData);
                    alert('ë©¤ë²„ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    
                    // ìˆ˜ì • ëª¨ë“œ í•´ì œ
                    delete submitBtn.dataset.editingMemberId;
                    submitBtn.textContent = 'ë©¤ë²„ ì¶”ê°€';
                } else {
                    // ìƒˆ ë©¤ë²„ ì¶”ê°€
                    if (!imageFile) {
                        alert('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    const { collection, addDoc } = window.firestoreFunctions;
                    await addDoc(collection(window.db, 'team'), {
                        name, position, email, image: imageBase64, createdAt: new Date().toISOString()
                    });
                    alert('ë©¤ë²„ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
                
                this.reset();
                await loadMembers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                
            } catch (err) {
                alert('ë©¤ë²„ ì €ì¥ ì‹¤íŒ¨: ' + err.message);
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Firebase ìƒíƒœ ì²´í¬
        window.addEventListener('load', function() {
            console.log('í˜ì´ì§€ ë¡œë“œë¨ - ë¡œê·¸ì¸ ìƒíƒœ:', isLoggedIn);
            console.log('Firebase ì´ˆê¸° ìƒíƒœ:', isFirebaseReady);
            console.log('window.db:', window.db);
            console.log('window.firestoreFunctions:', window.firestoreFunctions);
            
            if (isLoggedIn) {
                console.log('ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ Firebase ì¤€ë¹„ í™•ì¸ ì‹œì‘');
                checkFirebaseReady().then((ready) => {
                    console.log('Firebase ì¤€ë¹„ í™•ì¸ ê²°ê³¼:', ready);
                    if (ready) {
                        loadProjects();
                        loadMembers(); // íŒ€ ë©¤ë²„ ëª©ë¡ë„ í•¨ê»˜ ë¡œë“œ
                    }
                });
            }
        });

        // Firebase ì—°ê²° ìƒíƒœ í™•ì¸ í›„ ë©¤ë²„ ë¡œë“œ ì¬ì‹œë„
        setTimeout(() => {
            console.log('2ì´ˆ í›„ Firebase ìƒíƒœ ì¬í™•ì¸:', isFirebaseReady);
            if (isFirebaseReady && isLoggedIn) {
                console.log('2ì´ˆ í›„ ë©¤ë²„ ë¡œë“œ ì¬ì‹œë„');
                loadMembers();
            }
        }, 2000);

        // ì¶”ê°€ ì•ˆì „ì¥ì¹˜: 5ì´ˆ í›„ì—ë„ ë¡œë“œë˜ì§€ ì•Šìœ¼ë©´ ì¬ì‹œë„
        setTimeout(() => {
            console.log('5ì´ˆ í›„ Firebase ìƒíƒœ ì¬í™•ì¸:', isFirebaseReady);
            if (isFirebaseReady && isLoggedIn) {
                console.log('5ì´ˆ í›„ ë©¤ë²„ ë¡œë“œ ì¬ì‹œë„');
                loadMembers();
            }
        }, 5000);

        // Firebase ì—°ê²° ìƒíƒœ í™•ì¸ (í˜ì´ì§€ ë¡œë“œ ì‹œ)
        setTimeout(() => {
            console.log('5ì´ˆ í›„ Firebase ì—°ê²° ìƒíƒœ ìµœì¢… í™•ì¸:', isFirebaseReady);
            if (!isFirebaseReady) {
                console.log('Firebase ì—°ê²° ì‹¤íŒ¨ - ìƒíƒœ ì—…ë°ì´íŠ¸');
                updateFirebaseStatus(false, 'Firebase ì„¤ì •ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”');
            }
        }, 5000);


    </script>
</body>
</html> 